<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | SolarDrishti Insights</title>
    <link rel="icon" href="https://img.icons8.com/fluency/48/sun.png" type="image/x-icon">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-orange: #ff9100; --secondary-blue: #2c3e50; --bg-color: #f0f2f5; --text-color: #1a1a1a; --glass-bg: rgba(255, 255, 255, 0.85); }
        [data-theme="dark"] { --bg-color: #0b0e14; --text-color: #f1f1f1; --glass-bg: rgba(28, 33, 40, 0.95); }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-color); color: var(--text-color); transition: 0.5s ease; min-height: 100vh; display: flex; flex-direction: column; }
        .navbar { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .login-section { flex: 1; display: flex; align-items: center; justify-content: center; padding: 100px 20px 50px 20px; }
        
        /* --- MOBILE CENTER FIX START --- */
        .login-card { 
            background: var(--glass-bg); 
            backdrop-filter: blur(20px); 
            border-radius: 30px; 
            overflow: hidden; 
            max-width: 850px; 
            width: 100%; 
            box-shadow: 0 25px 60px rgba(0,0,0,0.15); 
            display: flex; 
            flex-direction: row; /* Desktop horizontal flow */
        }
        
        .login-sidebar { background: linear-gradient(135deg, var(--secondary-blue), #1a1a1a); color: white; padding: 40px; width: 40%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        
        .login-form-container { 
            padding: 60px; 
            width: 60%; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
        }

        /* Adjustments for mobile screens */
        @media (max-width: 768px) {
            .login-card {
                flex-direction: column; /* Stack vertically if sidebar was visible */
                max-width: 450px; /* Keep a nice slim width on mobile */
            }
            .login-form-container {
                width: 100%; /* Take full width of card */
                padding: 40px 30px; /* Adjust padding for smaller screens */
            }
        }
        /* --- MOBILE CENTER FIX END --- */

        .btn-login { background: linear-gradient(45deg, var(--primary-orange), #ff6d00); border: none; color: white; font-weight: 700; padding: 14px; border-radius: 15px; }
        .separator hr { border-color: var(--text-color); opacity: 0.2; }
        #celestial-anchor { 
        position: fixed; 
        bottom: 25px;       
        right: 25px;        
        z-index: 2000; 
        cursor: pointer; 
        width: 85px;        
        height: 85px;      
      
    }
    /* --- FIX: Force form labels to stay dark in Dark Mode --- */
.form-floating label {
    color: #1a1a1a !important; /* Always dark gray/black */
}

/* Optional: Ensure the text you type is also dark */
.form-control {
    color: #1a1a1a !important;
}
.sun-glow #main-circle {
    filter: drop-shadow(0 0 15px rgba(255, 145, 0, 0.8)); /* Intense Orange Glow */
}

/* Moon Glow (Dark Mode) */
.moon-glow #main-circle {
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.6)); /* Soft White/Blue Glow */
}
    </style>
</head>
<body onload="initApp()">
    <header>
        <nav class="navbar navbar-expand-lg fixed-top shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold d-flex align-items-center" href="{% url 'home' %}" style="color: var(--primary-orange);">
                    <i class="fa-solid fa-sun-plant-wilt me-2"></i> SOLAR<span class="text-secondary">DRISHTI</span>
                </a>
            </div>
        </nav>
    </header>

    <main class="login-section">
        <div class="login-card">
            <div class="login-sidebar d-none d-md-flex">
                <i class="fa-solid fa-cloud-sun fa-5x mb-4 text-warning"></i>
                <h2 class="fw-bold">Ready to shine?</h2>
                <p class="small opacity-75">Only registered users can access insights.</p>
            </div>
            
            <div class="login-form-container text-center">
                <h3 class="fw-bold mb-1">Welcome Back</h3>
                <p class="text-muted small mb-4">Login to your account</p>

                <form id="loginForm" method="POST" action="{% url 'login' %}">
                    {% csrf_token %}
                    <div class="form-floating mb-3">
                        <input type="text" name="username" class="form-control shadow-none" id="loginUsername" placeholder="Username" required>
                        <label for="loginUsername">Username</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="password" name="password" class="form-control shadow-none" id="loginPassword" placeholder="Password" required>
                        <label for="loginPassword">Password</label>
                    </div>

                    <button type="submit" class="btn btn-login w-100 mb-4 shadow">Sign In</button>
                    
                    <div class="separator d-flex align-items-center mb-4">
                        <hr class="flex-grow-1">
                        <span class="mx-2 small text-muted">OR</span>
                        <hr class="flex-grow-1">
                    </div>
                    
                    <div id="g_id_onload" 
                         data-client_id="720615112942-okm42cqmp0d7tbvcn3c5lthi68vd7312.apps.googleusercontent.com" 
                         data-callback="handleCredentialResponse" 
                         data-auto_prompt="false">
                    </div>
                    <div class="g_id_signin d-flex justify-content-center" data-type="standard" data-shape="pill" data-theme="outline" data-size="large" style="width: 100%;"></div>
                </form>
            </div>
        </div>
    </main>

    <input type="hidden" id="loginStatus" value="{{ login_success|yesno:'true,false' }}">
    <input type="hidden" id="authFailedMarker" value="{{ auth_failed|yesno:'true,false' }}">
    <aside id="celestial-anchor" onclick="toggleTheme()">
        <svg width="100%" height="100%" viewBox="0 0 100 100">
            <circle id="main-circle" cx="50" cy="50" r="40" fill="#FFD700" />
            <g id="eyes"><circle cx="35" cy="45" r="7" fill="white" /><circle class="iris" cx="35" cy="45" r="3.5" fill="black" /><circle cx="65" cy="45" r="7" fill="white" /><circle class="iris" cx="65" cy="45" r="3.5" fill="black" /></g>
            <path id="mouth" d="M 40 65 Q 50 75 60 65" stroke="black" stroke-width="2" fill="none" stroke-linecap="round" />    
        </svg>
    </aside>
    <script>
            // --- ADD THIS TO MAKE THE EYES MOVE ---
        document.addEventListener('mousemove', (e) => {
            document.querySelectorAll('.iris').forEach(iris => {
                const rect = iris.getBoundingClientRect();
                // Calculate angle between eye center and mouse
                const angle = Math.atan2(e.clientY - (rect.top + 3.5), e.clientX - (rect.left + 3.5));
                // Move the iris slightly in that direction
                iris.style.transform = `translate(${Math.cos(angle) * 3}px, ${Math.sin(angle) * 3}px)`;
            });
        });
        function initApp() {
            applyTheme(localStorage.getItem('theme') || 'light');
            const authFailed = document.getElementById('authFailedMarker').value;
            if (authFailed === 'true') alert("❌ Invalid Credentials!");
            const statusElement = document.getElementById('loginStatus');
            if (statusElement && statusElement.value === 'true') {
                localStorage.setItem('isLoggedIn', 'true');
                window.location.href = "{% url 'home' %}";
            }
        }

        function handleCredentialResponse(response) {
            const base64Url = response.credential.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const payload = JSON.parse(window.atob(base64));
            
            fetch("{% url 'google_verify' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify({ email: payload.email })
            })
            .then(res => {
                if (res.ok) {
                    localStorage.setItem('isLoggedIn', 'true');
                    window.location.href = "{% url 'home' %}";
                } else {
                    alert("❌ Account not found! Please Sign Up first.");
                }
            });
        }
        
        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            applyTheme(isDark ? 'light' : 'dark');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }

       function applyTheme(mode) {
    const sun = document.getElementById('main-circle');
    const container = document.getElementById('celestial-anchor'); // Get the wrapper
    
    document.body.setAttribute('data-theme', mode);
    
    if (sun && container) {
        // 1. Change Color
        sun.setAttribute('fill', mode === 'dark' ? '#bdc3c7' : '#FFD700');

        // 2. Remove old glow classes
        container.classList.remove('sun-glow', 'moon-glow');

        // 3. Add new glow class based on mode
        container.classList.add(mode === 'dark' ? 'moon-glow' : 'sun-glow');
    }
}
    </script>
</body>
</html>